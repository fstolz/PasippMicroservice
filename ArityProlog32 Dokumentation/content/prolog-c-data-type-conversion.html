<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN"
  "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" version="XHTML+RDFa 1.0" dir="ltr" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/terms/" xmlns:foaf="http://xmlns.com/foaf/0.1/" xmlns:og="http://ogp.me/ns#" xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns:sioc="http://rdfs.org/sioc/ns#" xmlns:sioct="http://rdfs.org/sioc/types#" xmlns:skos="http://www.w3.org/2004/02/skos/core#" xmlns:xsd="http://www.w3.org/2001/XMLSchema#">

<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta charset="utf-8">
<meta name="HandheldFriendly" content="true">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="http://peter-gabel.com/sites/default/files/photos1%20tight-307_0.jpg" type="image/jpeg">
<meta name="MobileOptimized" content="width">
<link rel="up" href="arityprolog32-language.html">
<link rel="canonical" href="prolog-c-data-type-conversion.html">
<link rel="shortlink" href="/node/72">
<link rel="prev" href="c-expressions-within-prolog-clauses.html">
<link rel="next" href="arityprolog32-warning-and-error-messages.html">
  <title>Prolog / C data type conversion | Peter Gabel</title>
  <style type="text/css" media="all">
@import url("http://peter-gabel.com/modules/system/system.base.css?np0twq");
@import url("http://peter-gabel.com/modules/system/system.menus.css?np0twq");
@import url("http://peter-gabel.com/modules/system/system.messages.css?np0twq");
@import url("http://peter-gabel.com/modules/system/system.theme.css?np0twq");
</style>
<style type="text/css" media="all">
@import url("http://peter-gabel.com/modules/book/book.css?np0twq");
@import url("http://peter-gabel.com/modules/comment/comment.css?np0twq");
@import url("http://peter-gabel.com/modules/field/theme/field.css?np0twq");
@import url("http://peter-gabel.com/modules/node/node.css?np0twq");
@import url("http://peter-gabel.com/modules/search/search.css?np0twq");
@import url("http://peter-gabel.com/modules/user/user.css?np0twq");
@import url("http://peter-gabel.com/sites/all/modules/ckeditor/css/ckeditor.css?np0twq");
</style>
<style type="text/css" media="all">
@import url("http://peter-gabel.com/sites/all/modules/ctools/css/ctools.css?np0twq");
</style>
<style type="text/css" media="all">
@import url("http://peter-gabel.com/sites/all/themes/skeletontheme/css/skeleton.css?np0twq");
@import url("http://peter-gabel.com/sites/all/themes/skeletontheme/css/style.css?np0twq");
@import url("http://peter-gabel.com/sites/all/themes/skeletontheme/css/buttons.css?np0twq");
@import url("http://peter-gabel.com/sites/all/themes/skeletontheme/css/layout.css?np0twq");
@import url("http://peter-gabel.com/sites/all/themes/skeletontheme/color/colors.css?np0twq");
</style>
  <script type="text/javascript" src="http://peter-gabel.com/misc/jquery.js?v=1.4.4"></script>
<script type="text/javascript" src="http://peter-gabel.com/misc/jquery.once.js?v=1.2"></script>
<script type="text/javascript" src="http://peter-gabel.com/misc/drupal.js?np0twq"></script>
<script type="text/javascript" src="http://peter-gabel.com/sites/all/themes/skeletontheme/js/jquery.mobilemenu.js?np0twq"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery(document).ready(function($) { 
	
	$("#navigation .content > ul").mobileMenu({
		prependTo: "#navigation",
		combine: false,
        switchWidth: 760,
        topOptionText: Drupal.settings.skeletontheme['topoptiontext']
	});
	
	});
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","skeletontheme":{"topoptiontext":"Select a page"},"ajaxPageState":{"theme":"skeletontheme","theme_token":"8rs2uwJCVZKau_WHtvtFnadVraZy3xcp0kM_5G72KzQ","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/themes\/skeletontheme\/js\/jquery.mobilemenu.js":1,"0":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/book\/book.css":1,"modules\/comment\/comment.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/ckeditor\/css\/ckeditor.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"sites\/all\/themes\/skeletontheme\/css\/skeleton.css":1,"sites\/all\/themes\/skeletontheme\/css\/style.css":1,"sites\/all\/themes\/skeletontheme\/css\/buttons.css":1,"sites\/all\/themes\/skeletontheme\/css\/layout.css":1,"sites\/all\/themes\/skeletontheme\/color\/colors.css":1}}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in one-sidebar sidebar-first page-node page-node- page-node-72 node-type-book">
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div id="wrap">
    <div class="container">
        
                
        <div class="clear"></div>
        
        <!-- #header -->
                <div id="header" class="sixteen columns clearfix">   
                
            <div class="inner">
    
                                
                                <div id="name-and-slogan">
                
                                        <div id="site-name">
                    <a href="/" title="Home" rel="home">Peter Gabel</a>
                    </div>
                                        
                                        <div id="site-slogan">
                    Interdisciplinary investigations into applied cognitive science                    </div>
                                    
                </div>
                            </div>
        </div><!-- /#header -->
        
                
        <div class="clear"></div>
        
        <!-- #navigation -->
        <div id="navigation" class="sixteen columns clearfix">
        
            <div class="menu-header">
                            				<div class="content">
				<ul class="menu"><li class="first leaf"><a href="/">Home</a></li>
<li class="leaf"><a href="/blog" title="">Blog</a></li>
<li class="expanded"><a href="/content/notebooks">Notebooks</a><ul class="menu"><li class="first leaf"><a href="/content/annotated-references">Annotated References</a></li>
<li class="leaf"><a href="arityprolog32.html">Arity/Prolog32</a></li>
<li class="leaf"><a href="/content/cognitive-science">Cognitive Science</a></li>
<li class="leaf"><a href="/content/natural-language-processing">Natural Language Processing</a></li>
<li class="leaf"><a href="/content/ontologies-and-logics">Ontologies and Logics</a></li>
<li class="leaf"><a href="/content/rich-data-machine-learning">Rich Data &amp; Machine Learning</a></li>
<li class="last leaf"><a href="/content/software-development">Software Development</a></li>
</ul></li>
<li class="leaf"><a href="/content/selected-publications">Selected publications</a></li>
<li class="leaf"><a href="/content/about-me">About me</a></li>
<li class="leaf"><a href="/contact" title="">Contact me</a></li>
<li class="last leaf"><a href="/content/join-my-team">Join my team</a></li>
</ul>                </div>
                        </div>
            
        </div><!-- /#navigation -->
        
                <!-- #sidebar-first -->
        <div id="sidebar-first" class="five columns">
              <div class="region region-sidebar-first">
    <div id="block-block-6" class="block block-block">

    
  <div class="content">
    
Welcome Guest. <a href="/user">Login</a>/<a href="/user/register">Register</a>.
        
  </div>
</div>
<div id="block-blog-recent" class="block block-blog">

    <h2>Recent blog posts</h2>
  
  <div class="content">
    <div class="item-list"><ul><li class="first"><a href="/content/defeating-janitorial-challenges-big-data">Defeating the Janitorial Challenges of Big Data</a></li>
<li><a href="/content/business-and-life-lessons-freshman-physics-problem">Business and life lessons from a freshman physics problem</a></li>
<li><a href="/content/wee-bit-about-we">A wee bit about &quot;we&quot;</a></li>
<li><a href="/content/category-theory">Category Theory</a></li>
<li><a href="/content/how-many-monitors-are-enough">How many monitors are enough?</a></li>
<li><a href="/content/words-words-words">Words, words, words!</a></li>
<li><a href="/content/some-thoughts-about-javascript">Some thoughts about JavaScript</a></li>
<li><a href="/content/eico-460">Eico 460</a></li>
<li><a href="/content/raspberry-pi">Raspberry Pi</a></li>
<li class="last"><a href="/content/arduino">Arduino</a></li>
</ul></div><div class="more-link"><a href="/blog" title="Read the latest blog entries.">More</a></div>  </div>
</div>
<div id="block-book-navigation" class="block block-book">

    <h2>Notebooks</h2>
  
  <div class="content">
      <div id="book-block-menu-67" class="book-block-menu">
    <ul class="menu"><li class="first last leaf"><a href="/content/annotated-references">Annotated References</a></li>
</ul>  </div>
  <div id="book-block-menu-12" class="book-block-menu">
    <ul class="menu"><li class="first last expanded active-trail"><a href="arityprolog32.html" class="active-trail">Arity/Prolog32</a><ul class="menu"><li class="first leaf"><a href="installing-arityprolog32.html">Installing Arity/Prolog32</a></li>
<li class="collapsed"><a href="writing-arityprolog32-applications.html">Writing Arity/Prolog32 Applications</a></li>
<li class="expanded active-trail"><a href="arityprolog32-language.html" class="active-trail">The Arity/Prolog32 Language</a><ul class="menu"><li class="first leaf"><a href="program-structure-and-data-types.html">Program structure and data types</a></li>
<li class="leaf"><a href="program-control.html">Program control</a></li>
<li class="leaf"><a href="unify-terms.html">Unify terms</a></li>
<li class="leaf"><a href="classify-compare-and-sort-terms.html">Classify, compare and sort terms</a></li>
<li class="leaf"><a href="term-structure-conversions.html">Term structure conversions</a></li>
<li class="leaf"><a href="arithmetic-and-arithmetic-expressions.html">Arithmetic and arithmetic expressions</a></li>
<li class="leaf"><a href="text-predicates.html">Text predicates</a></li>
<li class="collapsed"><a href="input-and-output-predicates.html">Input and output predicates</a></li>
<li class="collapsed"><a href="database-predicates.html">Database predicates</a></li>
<li class="leaf"><a href="dll-and-visibility-predicates.html">DLL and visibility predicates</a></li>
<li class="leaf"><a href="system-function-predicates.html">System function predicates</a></li>
<li class="leaf"><a href="definite-clause-grammars.html">Definite Clause Grammars</a></li>
<li class="leaf"><a href="source-code-processing-directives.html">Source code processing directives</a></li>
<li class="leaf"><a href="prolog-compiler-directives.html">Prolog compiler directives</a></li>
<li class="leaf"><a href="embedded-c-declarations.html">Embedded C declarations</a></li>
<li class="leaf"><a href="c-expressions-within-prolog-clauses.html">C expressions within Prolog clauses</a></li>
<li class="last leaf active-trail"><a href="prolog-c-data-type-conversion.html" class="active-trail active">Prolog / C data type conversion</a></li>
</ul></li>
<li class="collapsed"><a href="arityprolog32-warning-and-error-messages.html">Arity/Prolog32 Warning and Error Messages</a></li>
<li class="leaf"><a href="list-all-arityprolog32-predicates.html">List of all Arity/Prolog32 predicates</a></li>
<li class="leaf"><a href="glossary.html">Glossary</a></li>
<li class="last leaf"><a href="suggested-readings.html">Suggested Readings</a></li>
</ul></li>
</ul>  </div>
  <div id="book-block-menu-15" class="book-block-menu">
    <ul class="menu"><li class="first last collapsed"><a href="/content/cognitive-science">Cognitive Science</a></li>
</ul>  </div>
  <div id="book-block-menu-8" class="book-block-menu">
    <ul class="menu"><li class="first last collapsed"><a href="/content/natural-language-processing">Natural Language Processing</a></li>
</ul>  </div>
  <div id="book-block-menu-14" class="book-block-menu">
    <ul class="menu"><li class="first last collapsed"><a href="/content/ontologies-and-logics">Ontologies and Logics</a></li>
</ul>  </div>
  <div id="book-block-menu-13" class="book-block-menu">
    <ul class="menu"><li class="first last collapsed"><a href="/content/rich-data-machine-learning">Rich Data &amp; Machine Learning</a></li>
</ul>  </div>
  <div id="book-block-menu-11" class="book-block-menu">
    <ul class="menu"><li class="first last collapsed"><a href="/content/software-development">Software Development</a></li>
</ul>  </div>
  </div>
</div>
<div id="block-search-form" class="block block-search">

    <h2>Search</h2>
  
  <div class="content">
    <form action="/content/prolog-c-data-type-conversion" method="post" id="search-block-form" accept-charset="UTF-8"><div><div class="container-inline">
    <div class="form-item form-type-textfield form-item-search-block-form">
  <label class="element-invisible" for="edit-search-block-form--2">Search </label>
 <input title="Enter the terms you wish to search for." type="text" id="edit-search-block-form--2" name="search_block_form" value="" size="15" maxlength="128" class="form-text">
</div>
<div class="form-actions form-wrapper" id="edit-actions"><input type="submit" id="edit-submit" name="op" value="Search" class="form-submit"></div><input type="hidden" name="form_build_id" value="form-sVlEE1NMUXZcPe1noYVdB8DquQXQnaohs4LSI1Cmg6c">
<input type="hidden" name="form_id" value="search_block_form">
</div>
</div></form>  </div>
</div>
  </div>
        </div><!-- /#sidebar-first -->
                
                <div id="content" class="eleven columns">
		        
                    
                            <div id="breadcrumb"><h2 class="element-invisible">You are here</h2><div class="breadcrumb"><a href="/">Home</a><span class="sep">»</span><a href="arityprolog32.html">Arity/Prolog32</a><span class="sep">»</span><a href="arityprolog32-language.html">The Arity/Prolog32 Language</a><span class="sep">»</span>Prolog / C data type conversion</div></div>
                        
            <div id="main">
            
                                
                                
                                <h1 class="title" id="page-title">
                  Prolog / C data type conversion                </h1>
                                
                                
                                <div class="tabs">
                                  </div>
                                
                                
                                
                  <div class="region region-content">
    <div id="block-system-main" class="block block-system">

    
  <div class="content">
    <div id="node-72" class="node node-book clearfix" about="/content/prolog-c-data-type-conversion" typeof="sioc:Item foaf:Document">

      <span property="dc:title" content="Prolog / C data type conversion" class="rdf-meta element-hidden"></span><span property="sioc:num_replies" content="0" datatype="xsd:integer" class="rdf-meta element-hidden"></span>
      <div class="meta submitted">
            <span property="dc:date dc:created" content="2013-04-12T15:39:12-04:00" datatype="xsd:dateTime" rel="sioc:has_creator">Submitted by <span class="username" xml:lang="" about="/user/2" typeof="sioc:UserAccount" property="foaf:name" datatype="">Peter Gabel</span> on Fri, 04/12/2013 - 15:39</span>    </div>
  
  <div class="content clearfix">
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Unlike C where strings are handled as pointers to arrays of characters, Prolog treats strings as a unique data type.  Therefore they can not be directly cast to one another.  The embedded C compiler provides two methods for converting between Prolog and C strings: either through C functions within an embedded C expression or with Prolog predicates.  The functional versions are easier to use, but the predicates are provided for compatability.  Descriptions of these predicates and functions follow.</p>
<h3>make_c_string(+Ptr, +MaxLen, +String, -ActualLen)</h3>
<p class="rteindent1">The make_c_string predicate converts a Prolog string to a C string by copying characters from the Prolog string to a C buffer. If all of the characters have been copied and space remains in the buffer, then a terminating null (0) is added.  The Ptr argument is a pointer to the character buffer. Usually Ptr will be a long (far) pointer. However, if Ptr is an integer value that can be represented in 16 bits, then Ptr will be considered a near pointer relative to the default data group.  The MaxLen argument is an integer indicating the maximum number of characters that can be copied to the location at Ptr. The String argument is the Prolog string that you want to convert to a C string. The ActualLength argument is returned by the system and indicates the actual length of the string stored, except for the terminating null if it was added.</p>
<h3>make_prolog_string(+Ptr, -String)</h3>
<h3>make_prolog_string(+Ptr, +Length, -String)</h3>
<p class="rteindent1">The make_prolog_string predicates copy a C string to be a prolog string which is unified with the String argument.  The Ptr argument has the same meaning as in the make_c_string/4 predicate.   If Length is specified, then only that number of characters are copied. If Length is not specified, then the C string is assumed to be an asciz string and copying ends at the terminating 0.</p>
<h3>int far pascal MakeCString (char far *buf, short sizebuf, short pstring);</h3>
<p class="rteindent1">The MakeCString function can be called within and embedded C expression an copies the characters from a Prolog string into a previously allocated char buffer pointed to by the buf argument. The maximum size of the buffer is specified in the sizebuf argument.  If room remains, a terminating null (0) character is added.  The actual number of characters that were copied (except for the terminating null) is passed as the return value for the function. The Prolog string is specified in the pstring argument.  This argument is specified as &amp;StringVariable where the StringVariable has been unified with a Prolog string.</p>
<h3>int far pascal MakePrologString (char far *buf, short pstring);</h3>
<p class="rteindent1">The MakePrologString function converts a C char array specified by the buf argument into a Prolog string which is unified with the Prolog variable specified by pstring argument. The pstring argument is specified as &amp;StringVariable, where StringVariable is an uninstantiated Prolog variable.  The C string is assumed to be an asciz string so characters are copied until the terminating 0 is found. The number of characters copied is then passed as the return value.</p>
<h3>void far pascal MakeCountedPrologString (char far *buf, short len, short pstring);</h3>
<p class="rteindent1">The MakeCountedPrologString function is similar to the MakePrologString function in that is also converts a C char array specified by the buf argument into a Prolog string which is unified with the Prolog variable specified by the pstring argument. However, the MakeCountedPrologString function does not look for the terminating 0, rather it copies len characters.</p>
<p> </p>
<h2>An example of converting strings</h2>
<p>The following example is extracted from the strbuf.ari example file included with the Arity/Prolog32 distribution. This file defines a number of predicates that use embedded C to access a 128 character buffer which is defined at the beginning of the program:</p>
<pre>
:- c.
typedef char far *cstring;
char buffer[128];
short buffer_len;                          /* current length of the buffer */
:- prolog.

:- define( bufSIZE = 128).                 /* Macro for the buffer size. */</pre><p> </p>
<p>The function versions of the predicates to store and retrieve a string from this buffer are defined as:</p>
<pre>
string_buf(String) :-
    string_length(String,SLen0),
    inc(SLen0,SLen),
    ifthenelse( SLen &gt; bufSIZE,
                Len = bufSIZE,
                Len = SLen
    ),
    {
        'MakeCString'(buffer, Len, &amp;String);
        buffer_len = (Len - 1)
    }.

buf_string(String) :-
    { 'MakeCountedPrologString'(buffer, buffer_len, &amp;String) }.</pre><p> </p>
<p>The predicate versions of these predicates would be defined as:</p>
<pre>
string_buf(String) :-
    string_length(String, SLen),
    ifthenelse( SLen &gt; bufSIZE,
                Len = bufSIZE,
                Len = SLen
    ),
    {
        Ptr:cstring;
        Ptr is buffer
    },
    make_c_string(Ptr, Len, String, _),
    {
        Len:short;
        buffer_len = (Len - 1)
    }.

buf_string(String) :-
    {
        Ptr:cstring;
        Len:short;
        Ptr is buffer;
        Len is buffer_len
    },
    make_prolog_string(Ptr, Len, String).</pre><p> </p>
<p> </p>
<h2>An example of converting Prolog datatypes</h2>
<p>The following is an example of converting data between C and Prolog.  The example is contained in the globals.ari file supplied with the Arity/Prolog32 distribution.  This file defines two predicates, one for storing (set_global) and the other for retrieving (get_global) Prolog terms in 32 global locations allocated in C. These global values are referenced by their position in this array, by specifying an integer in the range 0 through 31.  These functions could be used within a program to store a global integer or floating point value, a database reference number of an important term or string, or the term or string itself.  The predicates are defined as public and visible so that they may be used within another program or the interpreter:</p>
<pre>
:- public (set_global/2, get_global/2).
:- visible (set_global/2, get_global/2).</pre><p>The C declaration space defines a number typedefs that will be needed in embedded C expressions, as well as the global_struct structure that is used to store a global value.  The malloc.h C header file is included to do allocation and removal of storage for floating-point numbers, strings and general terms.  Since the functions declared by this header file need to be intialized, you must include a C startup with any program that uses these functions. See the following section for information on C startup files.</p>
<pre>
:- c.
#define MAXGLOBALS 32
typedef char far *cstring;       /* Used in embedded C expressions */
typedef double far *pdouble;
typedef void far *pvoid;
typedef struct {
                 short type;
                 long value;
} global_struct, *global_ptr;
global_struct globals[MAXGLOBALS];
#include "malloc.h"            /* Necessary for strings and floats */
:- prolog.</pre><p> </p>
<p>Each global_struct in the globals array may contain a value.  The type of the value is stored in the type member of the structure and can be one of the following constant values.  The type indicates how the long value should be interpreted:</p>
<pre>
:- define( typeINTEGER = 0 ).
:- define( typeATOM    = 1 ).
:- define( typeREF     = 2 ).
:- define( typeSTRING  = 3 ).
:- define( typeFLOAT   = 4 ).
:- define( typeTERM    = 5 ).</pre><p> </p>
<p>The set_global predicate is then very simple, we call an auxilliary predicate which will return the short Type code and long Value that we are storing. Then we assign to a temorary pointer the address of the element of the globals array that we are interested in.  Now we examine if there is an allocated type (string, floating-point number or general term) already stored in that location.  If so, we need to deallocate it by calling the _ffree function.  Then we are free to replace the type and value members with our values:</p>
<pre>
set_global(Global, Term) :-
    set_global_aux(Term, Type ,Value),
    {
        Type:short,
        Value:long,
        ptr:global_ptr;
        ptr = &amp;(globals .. [Global]),
        ifthenelse( (
            ((ptr -&gt;type) =:= typeSTRING) or
            ((ptr -&gt;type) =:= typeFLOAT) or
            ((ptr -&gt;type) =:= typeTERM)
            ),
            ('_ffree'( pvoid(ptr -&gt; value) ), 1),   /* must have value */
            1
        ),
        ( ptr -&gt; type ) = Type,
        ( ptr -&gt; value ) = Value
    }.</pre><p> </p>
<p>Each clause of set_global_aux determines the type of the given Term, then converts that term into a long Value and returns a type code.  Strings, floating-point numbers and terms can not be represented in a long value.  Therefore, we need to allocate an appropriate amount of memory, using the _fmalloc function. We then place our Prolog term in the allocated space and return a far pointer to the term as the long value to store in the globals array structure.</p>
<p>Note: general terms are converted to a string using the string_termq predicate so that they will properly convert back.</p>
<pre>
set_global_aux(Term, typeINTEGER, Value) :-
    integer(Term),
    !,
    Value = Term.
set_global_aux(Term, typeATOM, Value) :-
    atom(Term),
    !,
    {
        Term:'#atom',
        Value:long,
        Value is Term
    }.
set_global_aux(Term, typeREF, Value) :-
    ref(Term),
    !,
    {
        Term:'#ref',
        Value:long,
        Value is Term
    }.
set_global_aux(Term, typeSTRING, Value) :-
    string(Term),
    !,
    string_length(Term, Len),
    {
        Value:cstring;
        Len:short;
        Value is '_fmalloc'(Len+1);
        'MakeCString'(Value, Len+1, &amp;Term)
    }.
set_global_aux(Term, typeFLOAT, Value) :-
    float(Term),
    !,
    {
        Term:double,
        Value:pdouble,
        Value is '_fmalloc'(sizeof(double)),    % note: use of quotes
        (* Value) = Term
    }.
set_global_aux(Term, typeTERM, Value) :-
    string_termq(String, Term),
    set_global_aux(String, _, Value).</pre><p> </p>
<p>The get_global predicate retrieves the Type code and Value from the globals array structure and uses an auxilliary predicate to convert the Value into a term which is then unified with the Term argument.  This allows proper unification if Term was bound to a value.</p>
<pre>
get_global(Global, Term) :-
    {
        (Type,Global):short,
        Value:long,
        ptr:global_ptr,
        ptr is &amp;( globals .. [Global]),
        Type is (ptr -&gt; type),
        Value is (ptr -&gt; value)
    },
    get_global_aux(Type, Value, Term0),
    Term = Term0.</pre><p> </p>
<p>Each clause of get_global_aux converts the long Value into a Prolog Term based on the Type code provided.  Strings, floating-point numbers and terms are passed as far pointers to the actual data, so they are not converted directly:</p>
<pre>
get_global_aux(typeINTEGER, Value, Term) :-
    !,
    Term = Value.
get_global_aux(typeATOM, Value, Term) :-
    !,
    {
        Term:'#atom';
        Value:long;
        Term is Value
    }.
get_global_aux(typeREF, Value, Term) :-
    !,
    {
        Term:'#ref';
        Value:long;
        Term is Value
    }.
get_global_aux(typeSTRING, Value, Term) :-
    !,
    {
        Value:cstring;
        'MakePrologString'(Value, &amp;Term)
    }.
get_global_aux(typeFLOAT, Value, Term) :-
    !,
    {
        Value:pdouble,
        Term:double,
        Term is (*Value)
    }.
get_global_aux(typeTERM, Value, Term) :-
    get_global_aux(typeSTRING, Value, String),
    string_termq(String, Term).</pre><p> </p>
<p> </p>
</div></div></div>  <div id="book-navigation-12" class="book-navigation">
    
        <div class="page-links clearfix">
              <a href="c-expressions-within-prolog-clauses.html" class="page-previous" title="Go to previous page">‹ C expressions within Prolog clauses</a>
                    <a href="arityprolog32-language.html" class="page-up" title="Go to parent page">up</a>
                    <a href="arityprolog32-warning-and-error-messages.html" class="page-next" title="Go to next page">Arity/Prolog32 Warning and Error Messages ›</a>
          </div>
    
  </div>
  </div>

      <div class="link-wrapper">
      <ul class="links inline"><li class="comment_forbidden first last"><span><a href="/user/login?destination=node/72%23comment-form">Log in</a> or <a href="/user/register?destination=node/72%23comment-form">register</a> to post comments</span></li>
</ul>    </div>
  
  
</div>
  </div>
</div>
  </div>
                                
            </div>
        
        </div><!-- /#content -->
        
                
        <div class="clear"></div>
        
                <!-- #featured -->
        <div id="featured" class="sixteen columns clearfix">
            
                        <div class="one_half">
              <div class="region region-featured-left">
    <div id="block-block-2" class="block block-block">

    
  <div class="content">
    <div class="cta clearfix" style="height:145px">
<h3>Headspace Sprockets</h3>

<p><img class="alignleft" alt="" src="/sites/default/files/small_iStock_000017030156_Small_1.jpg" style="height:48px; width:48px">Learn more about my company.
</p>
<div class="clear"></div>
<br>
<div class="button small right"><a class="button white" href="http://www.headspacesprockets.com" target="_blank">Visit Headspace Sprockets</a></div>
</div>
<p>  </div>
</div>
  </div>
            </div>
            
            <div class="one_half last">
              <div class="region region-featured-right">
    <div id="block-block-1" class="block block-block">

    
  <div class="content">
    <div class="cta clearfix" style="height:145px">
<h3>GitHub</h3>
<p><img class="alignleft" src="/sites/all/themes/skeletontheme/mockup/arrow.png" alt="">I have shared some projects on GitHub. Arity/Prolog32 distributions are <a href="installing-arityprolog32.html"><b>available here</b></a> in this site's Arity/Prolog32 notebook.</p>
<div class="clear"></div>
<div class="button small right"><a class="button white" href="https://github.com/Peter-Gabel" target="_blank">Fork me on GitHub</a></div>
</div>  </div>
</div>
  </div>
            </div>
                        
        </div><!-- /#featured -->
                
	</div>
        
	<div id="footer">
        <div class="container">
        	<div class="sixteen columns clearfix">
        
                <div class="one_third">
                  <div class="region region-footer-first">
    <div id="block-block-3" class="block block-block">

    <h2>Privacy and Terms of Use</h2>
  
  <div class="content">
    <p><a href="http://creativecommons.org/licenses/by-nc-nd/3.0/us/" rel="license"><img alt="Creative Commons License" src="http://i.creativecommons.org/l/by-nc-nd/3.0/us/88x31.png" style="border-width:0"></a><br>
<strong>©&nbsp;2017&nbsp;Peter L. Gabel</strong>. Except where designated as licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/us/" target="_blank" rel="license"><strong>Creative Commons Attribution-NonCommercial-NoDerivs 3.0 United States License</strong></a>, Peter L. Gabel reserves all rights associated with the materials on this site. Your use is subject to 
<strong>
<a href="/content/privacy-and-terms-use" target="_blank">Additional terms of use</a></strong></p>  </div>
</div>
  </div>
                </div>
                
                <div class="one_third">
                  <div class="region region-footer-second">
    <div id="block-block-4" class="block block-block">

    
  <div class="content">
    <p><a href="http://www.linkedin.com/pub/peter-gabel/0/18/428" target="_blank"><img alt="View Peter Gabel's profile on LinkedIn" src="http://www.linkedin.com/img/webpromo/btn_viewmy_160x33.png" style="height:33px; width:160px"></a></p>
  </div>
</div>
<div id="block-user-login" class="block block-user">

    <h2>User login</h2>
  
  <div class="content">
    <form action="/content/prolog-c-data-type-conversion?destination=node/72" method="post" id="user-login-form" accept-charset="UTF-8"><div><div class="form-item form-type-textfield form-item-name">
  <label for="edit-name">Username <span class="form-required" title="This field is required.">*</span></label>
 <input type="text" id="edit-name" name="name" value="" size="15" maxlength="60" class="form-text required">
</div>
<div class="form-item form-type-password form-item-pass">
  <label for="edit-pass">Password <span class="form-required" title="This field is required.">*</span></label>
 <input type="password" id="edit-pass" name="pass" size="15" maxlength="128" class="form-text required">
</div>
<div class="item-list"><ul><li class="first"><a href="/user/register" title="Create a new user account.">Create new account</a></li>
<li class="last"><a href="/user/password" title="Request new password via e-mail.">Request new password</a></li>
</ul></div><input type="hidden" name="form_build_id" value="form-w0ngOJdNsJREZf8zYA2BrGMOaUTFNuuPSk3pwGpJuqI">
<input type="hidden" name="form_id" value="user_login_block">
<div class="form-item form-type-textfield form-item-captcha-questions-answer-given">
  <label for="edit-captcha-questions-answer-given">What is the name of my company? Hint: you can find it below. <span class="form-required" title="This field is required.">*</span></label>
 <input type="text" id="edit-captcha-questions-answer-given" name="captcha_questions_answer_given" value="" size="60" maxlength="128" class="form-text required">
<div class="description">Please answer the question. (We&#039;re keeping spam bots out!)</div>
</div>
<div class="form-actions form-wrapper" id="edit-actions--2"><input type="submit" id="edit-submit--2" name="op" value="Log in" class="form-submit"></div></div></form>  </div>
</div>
  </div>
                </div>
                
                <div class="one_third last">
                  <div class="region region-footer-third">
    <div id="block-block-5" class="block block-block">

    
  <div class="content">
    <p><em>The power of the unaided mind is highly overrated. Without external aids, memory, thought, and reasoning are all constrained. But human intelligence is highly flexible and adaptive, superb at inventing procedures and objects that overcome its own limits. The real powers come from devising external aids that enhance cognitive abilities. How have we increased memory, thought, and reasoning? By the inventions of external aids: It is things that make us smart.</em></p>
<p>-- Donald Norman, <strong><a href="http://www.amazon.com/Things-That-Make-Smart-Attributes/dp/0201626950/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1368737063&amp;sr=1-1" target="_blank">Things that make us smart</a></strong></p>
  </div>
</div>
  </div>
                </div>
        
                <div class="clear"></div>
                
                                
                <div class="clear"></div>
                
                <div id="credits">
				<!--
				&copy;
                2018                                 Peter Gabel<br/>
                				-->
                Original theme by <a href="http://www.drupalizing.com" target="_blank">Drupalizing</a>, a project of <a href="http://www.morethanthemes.com" target="_blank">More than (just) Themes</a>. Original design by <a href="http://www.simplethemes.com/" target="_blank">Simple Themes</a>.
                </div>
        	</div>
        </div>
    </div>
    
</div> <!-- /#wrap -->  </body>
</html>
